<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="A complete and seamless Nonmem simulation interface from within R. Turns Nonmem control streams into simulation control streams, executes them with specified simulation input data and returns the results. The simulation is performed by Nonmem, eliminating time spent and risks of re-implementation of models in other tools.">
<title>Seamless Nonmem Simulation Platform • NMsim</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Seamless Nonmem Simulation Platform">
<meta property="og:description" content="A complete and seamless Nonmem simulation interface from within R. Turns Nonmem control streams into simulation control streams, executes them with specified simulation input data and returns the results. The simulation is performed by Nonmem, eliminating time spent and risks of re-implementation of models in other tools.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">NMsim</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.10.921</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-vignettes">Vignettes</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-vignettes">
    <a class="dropdown-item" href="articles/NMsim-basics.html">Simulation of new subjects</a>
    <a class="dropdown-item" href="articles/NMsim-VPC.html">Simulations for VPCs</a>
    <a class="dropdown-item" href="articles/NMsim-config.html">NMsim Configuration</a>
    <a class="dropdown-item" href="articles/NMsim-known.html">Simulate known subjects</a>
    <a class="dropdown-item" href="articles/NMsim-TypSubj.html">Simulate typical subjects</a>
    <a class="dropdown-item" href="articles/NMsim-ParamUncertain.html">Simulations with parameter uncertainty</a>
    <a class="dropdown-item" href="articles/NMsim-DataCreate.html">Creation of Simulation Data Sets</a>
    <a class="dropdown-item" href="articles/NMsim-ResidVar.html">Simulation with residual variability</a>
    <a class="dropdown-item" href="articles/NMsim-varyPars.html">Varying parameter values</a>
    <a class="dropdown-item" href="articles/NMsim-ReuseSimSubjects.html">Reuse simulated subjects</a>
    <a class="dropdown-item" href="articles/NMsim-speed.html">Debugging, Speed, and Disk Space</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/philipdelff/NMsim/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/philipdelff/NMsim/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="nmsim">NMsim<a class="anchor" aria-label="anchor" href="#nmsim"></a>
</h1></div>
<p><code>NMsim</code> is an R package that can simulate Nonmem models (using the <code>NMsim</code> function) based on just a simulation data set and a path to an estimation control stream. It will also retrive and combine output tables with input data once Nonmem has finished and return the results to R.</p>
<div class="section level2">
<h2 id="install">Install<a class="anchor" aria-label="anchor" href="#install"></a>
</h2>
<p><code>NMsim</code> is on CRAN and github:</p>
<pre class="{r}"><code><span><span class="co">## From CRAN</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"NMsim"</span><span class="op">)</span></span>
<span><span class="co">## From github</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://remotes.r-lib.org" class="external-link">remotes</a></span><span class="op">)</span></span>
<span><span class="fu">install_github</span><span class="op">(</span><span class="st">"philipdelff/NMsim"</span><span class="op">)</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="simulate-a-nonmem-model-from-r">Simulate a Nonmem model from R<a class="anchor" aria-label="anchor" href="#simulate-a-nonmem-model-from-r"></a>
</h2>
<p>In its simplest use, a simulation of the (estimated) model stored in “path/to/file.mod” using the simulation input data set stored in the variable <code>data.sim</code> this way:</p>
<pre class="{r,eval=false}"><code><span><span class="va">simres</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/NMsim.html">NMsim</a></span><span class="op">(</span>path.mod<span class="op">=</span><span class="st">"/path/to/file.mod"</span>,</span>
<span>                data<span class="op">=</span><span class="va">data.sim</span><span class="op">)</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="supported-types-of-simulations">Supported types of simulations<a class="anchor" aria-label="anchor" href="#supported-types-of-simulations"></a>
</h2>
<p><code>NMsim</code> has a flexible way to define simulation methods. The following methods are currently provided:</p>
<ul>
<li>Simulation of new subjects (default or explicitly with <code>method.sim=NMsim_default</code>)</li>
<li>Simulation of a typical subject (ETAs equal 0, <code>method.sim=NMsim_typical</code>)</li>
<li>Simulation of subjects already estimated in Nonmem model (<code>method.sim=NMsim_known</code>)</li>
<li>Simulation with parameter uncertainty based on a Nonmem covariance step (<code>method.sim=NMsim_VarCov</code>)</li>
<li>Simulation “as is” in case you already prepared a simulation control stream and just want to automate the use of it in combination with simulation data sets (<code>method.sim=NMsim_asis</code>)</li>
</ul>
<p>To learn how to run these simulations on your Nonmem models, get started with <a href="https://philipdelff.github.io/NMsim/articles/NMsim-basics.html"><code>NMsim-basics.html</code></a>. It is really easy.</p>
<p>In addition, <code>NMsim</code> can simulate multiple models at a time. E.g., if a bootstrap run of a model is available, NMsim can run the simulation with each of the bootstrap models and collect all the results in one dataset. This provides a robust and easy way to simulate a Nonmem model with uncertainty.</p>
<p>You can also write your own methods, if you have some other Nonmem-based simulation (or other job) you want to automate using <code>NMsim</code>.</p>
<p>Many features are available. Prominent ones are:</p>
<ul>
<li>Can use submit jobs to clusters (so running the simulation on say 1,000 model estimates from a bootstrap is actually not that hard).</li>
<li>Simulation replicates using Nonmem <code>SUBPROBLEMS</code> feature avaible through the <code>subproblems</code> argument</li>
<li>Can modify the simulation control stream on the fly - a powerful feature for studying the effect of varying model parameters</li>
<li>Simulations of models on transformed observations can be automatically transformed back using the <code>transform</code> argument.</li>
</ul>
<p>If residual variability is not implemented in the simulated model, <code>NMsim</code> provides a way (<code><a href="reference/addResVar.html">addResVar()</a></code>) to add residual variability in R after the simulation has been run.</p>
</div>
<div class="section level2">
<h2 id="how-nmsim-works">How NMsim works<a class="anchor" aria-label="anchor" href="#how-nmsim-works"></a>
</h2>
<p>One strength of <code>NMsim</code> is that it does not simulate, translate or otherwise interpret a Nonmem model. Instead, it automates the Nonmem simulation workflow (including execution of Nonmem) and wraps it all into one R function. In the example given above, <code>NMsim</code> will do the following:</p>
<ul>
<li>Save the simulation input data in a csv file for Nonmem</li>
<li>Create a simulation input control stream based on <code>file.mod</code> ($INPUT and $DATA matching the saved simulation data set; $SIMULATE instead of $ESTIMATION and $COVARIANCE)</li>
<li>Update and fix initial values based on estimate (from <code>file.ext</code>)</li>
<li>Run Nonmem on the generated simulation control stream</li>
<li>Collect output data tables, combine them, and merge with the simulation input data</li>
<li>Return the collected data in R</li>
</ul>
<p>This eliminates the need for re-implementation of a model for simulation purposes. On the other hand, this also means that <code>NMsim</code> can’t work without Nonmem.</p>
<p><code>NMsim</code> can call Nonmem directly or via <code>PSN</code>. If <code>NMsim</code> is run on a system where Nonmem cannot be executed, <code>NMsim</code> can still prepare the simulation control stream and datafile.</p>
<p><code>NMsim</code> is in itself a small R package. It makes extensive use of functionality to handle Nonmem data and control streams provided by the R package <a href="https://cran.r-project.org/package=NMdata" class="external-link"><code>NMdata</code></a>.</p>
</div>
<div class="section level2">
<h2 id="supported-model-types">Supported model types<a class="anchor" aria-label="anchor" href="#supported-model-types"></a>
</h2>
<p>The methods currently provided by <code>NMsim</code> will work with (many or most) Pop PK models and most continuous-scale PD models. Methods are currently not provided for for time-to-event models. Also, depending on the coding of the models, other censored data models may not work out of the box, because the model may not have a single variable (in Nonmem) that simulates the wanted information for all data rows, as their interpretation may depend on other values.</p>
<p>The input data set must contain whatever variables are needed by the Nonmem model. A common issue is if the Nonmem model uses a covariate that is not in the simulation input data set. <code>NMdata</code>’s <a href="https://philipdelff.github.io/NMdata/reference/NMcheckData.html" class="external-link">NMcheckData</a> is a good help identifying input data issues before running Nonmem - and when Nonmem acts unexpectedly.</p>
</div>
<div class="section level2">
<h2 id="nmsim-and-speed">NMsim and speed<a class="anchor" aria-label="anchor" href="#nmsim-and-speed"></a>
</h2>
<p>Nonmem may not be the fastest simulator out there. But actually most often, the reason Nonmem is slow at providing a simulation result is that it takes a long time writing the <code>$TABLE</code> files (yes, that can account for 90% or more of the time Nonmem spends). <code>NMsim</code> provides a simple way to get around this. The argument <code>text.table</code> can be used to define only the columns needed in the simulation output (which may be as little as <code>PRED</code>, <code>IPRED</code>, and a couple more - remember the input data is merged back automatically). As a result, <code>NMsim</code> may still be slower than a re-implementation in a different framework. But it’s extremely easy to do.</p>
</div>
<div class="section level2">
<h2 id="requirements">Requirements<a class="anchor" aria-label="anchor" href="#requirements"></a>
</h2>
<p>Currently, <code>NMsim</code> can only run Nonmem on Unix/Linux systems. It wouldn’t be too big a deal to add support for Windows, so reach out if you need it. It is possible to run <code>R</code> on Windows and run Nonmem on a Unix/Linux system through SSH if needed.</p>
<p>NMsim does not need PSN but can use it. However, not all features are available with PSN, so for some features you will have to specify the path to the Nonmem executable (say <code>path.nonmem=/path/to/nmfe75</code> or any Nonmem executable you want to use). Specifically of the simulation types currently available, simulation of known subjects is not possible using PSN (but works if a Nonmem executable is provided).</p>
<p>If PSN is used, <code>NMsim</code> uses PSN’s <code>execute</code> to run models. In addition, <code>NMsim</code> by default uses PSN’s <code>update_inits</code> to update initial values in control streams, if PSN is available. <code>NMsim</code> does also include its own simple function to do this if <code>PSN</code> is not available.</p>
</div>
<div class="section level2">
<h2 id="is-nmsim-reliable">Is <code>NMsim</code> reliable?<a class="anchor" aria-label="anchor" href="#is-nmsim-reliable"></a>
</h2>
<p>Importantly, <code>NMsim</code> does not (at least not by default) modify, translate or simulate the model itself. It does modify control stream sections <code>$INPUT</code>, <code>$DATA</code>, <code>$ESTIMATION</code>, <code>$SIMULATION</code>, <code>$THETA</code>, <code>$OMEGA</code>, <code>$SIGMA</code>, <code>$TABLE</code> as needed. The fact that <code>NMsim</code> allows for skipping the re-implementation but just uses Nonmem to simulate the Nonmem model as is, eliminates the risk of discrepancies between the estimated model and the simulated model.</p>
<p>The produced control stream is saved together with simulation data set open for manual inspection and can obviously be run with Nonmem independently of <code>NMsim</code>.</p>
</div>
<div class="section level2">
<h2 id="easily-create-simulation-datasets">Easily create simulation datasets<a class="anchor" aria-label="anchor" href="#easily-create-simulation-datasets"></a>
</h2>
<p><code>NMsim</code> includes functions (<code>NMcreateDoses</code> and <code>addEVID2</code>) to very easily create simulation data sets. While one certainly does not need to use these functions to use <code>NMsim</code>, they do add to the package providing a framework that enables a complete simulation workflow in only 5-15 simple lines of R code.</p>
</div>
<div class="section level2">
<h2 id="run-nonmem-from-r">Run Nonmem from R<a class="anchor" aria-label="anchor" href="#run-nonmem-from-r"></a>
</h2>
<p>There are several other packages out there that can do this, and <code>NMsim</code> may not be your best choice if this feature is all you are looking for. However, running Nonmem using the <code><a href="reference/NMexec.html">NMexec()</a></code> function provided by <code>NMsim</code> has one important advantage in that it saves the input data together with the Nonmem control streams. This ensures that output data can be merged with input data as it went into the model, even if the input data file should be modified or lost.</p>
<ul>
<li>Saves input data with Nonmem model</li>
<li>Provides a simple R command for submission of Nonmem jobs</li>
<li>Optionally handles cluster configuration</li>
<li>Saves the xml file by default</li>
</ul>
<p><code>NMexec</code> will submit model runs to a cluster by default. This can be switched off for running Nonmem locally. Please notice the jobs are submitted to a cluster in a very specific way using <code>PSN</code>. If your setup is different, this is for now not supported. Please use <code>NMexec(sge=FALSE)</code> in that case (which may not be desirable). Notice that simulations are not done on a cluster by default so you may still be able to use <code>NMsim</code>.</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=NMsim" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/philipdelff/NMsim/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/philipdelff/NMsim/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing NMsim</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Philip Delff <br><small class="roles"> Author, maintainer </small>  </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Philip Delff.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  <script data-goatcounter="https://nmsim.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
</body>
</html>
