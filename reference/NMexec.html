<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Execute Nonmem and archive input data with model files — NMexec • NMsim</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Execute Nonmem and archive input data with model files — NMexec"><meta name="description" content="Execute Nonmem from within R - optionally but by default in
parallel. Archiving the input data ensures that postprocessing can
still be reproduced if the input data files should be updated."><meta property="og:description" content="Execute Nonmem from within R - optionally but by default in
parallel. Archiving the input data ensures that postprocessing can
still be reproduced if the input data files should be updated."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">NMsim</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.3.908</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fas fa-home fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes"><li><a class="dropdown-item" href="../articles/NMsim-basics.html">Simulation of New Subjects</a></li>
    <li><a class="dropdown-item" href="../articles/NMsim-VPC.html">Simulations for VPCs</a></li>
    <li><a class="dropdown-item" href="../articles/NMsim-config.html">Requirements and Configuration</a></li>
    <li><a class="dropdown-item" href="../articles/NMsim-known.html">Simulate Known Subjects</a></li>
    <li><a class="dropdown-item" href="../articles/NMsim-TypSubj.html">Simulate Typical Subjects</a></li>
    <li><a class="dropdown-item" href="../articles/NMsim-ParamUncertain.html">Simulations with Parameter Uncertainty</a></li>
    <li><a class="dropdown-item" href="../articles/NMsim-DataCreate.html">Creation of Simulation Data Sets</a></li>
    <li><a class="dropdown-item" href="../articles/NMsim-ResidVar.html">Simulation with Residual Variability</a></li>
    <li><a class="dropdown-item" href="../articles/NMsim-varyPars.html">Varying Parameter Values</a></li>
    <li><a class="dropdown-item" href="../articles/NMsim-ReuseSimSubjects.html">Reuse Simulated Subjects</a></li>
    <li><a class="dropdown-item" href="../articles/NMsim-speed.html">Debugging, Speed, and Disk Space</a></li>
  </ul></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/philipdelff/NMsim/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/philipdelff/NMsim/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Execute Nonmem and archive input data with model files</h1>
      <small class="dont-index">Source: <a href="https://github.com/philipdelff/NMsim/blob/main/R/NMexec.R" class="external-link"><code>R/NMexec.R</code></a></small>
      <div class="d-none name"><code>NMexec.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Execute Nonmem from within R - optionally but by default in
parallel. Archiving the input data ensures that postprocessing can
still be reproduced if the input data files should be updated.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">NMexec</span><span class="op">(</span></span>
<span>  <span class="va">files</span>,</span>
<span>  <span class="va">file.pattern</span>,</span>
<span>  <span class="va">dir</span>,</span>
<span>  sge <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">input.archive</span>,</span>
<span>  nc <span class="op">=</span> <span class="fl">64</span>,</span>
<span>  dir.data <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  wait <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">args.psn.execute</span>,</span>
<span>  update.only <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  nmquiet <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">method.execute</span>,</span>
<span>  <span class="va">dir.psn</span>,</span>
<span>  <span class="va">path.nonmem</span>,</span>
<span>  <span class="va">system.type</span>,</span>
<span>  <span class="va">files.needed</span>,</span>
<span>  clean <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  backup <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-files">files<a class="anchor" aria-label="anchor" href="#arg-files"></a></dt>
<dd><p>File paths to the models (control streams) to run
nonmem on. See file.pattern too.</p></dd>


<dt id="arg-file-pattern">file.pattern<a class="anchor" aria-label="anchor" href="#arg-file-pattern"></a></dt>
<dd><p>Alternatively to files, you can supply a
regular expression which will be passed to list.files as the
pattern argument. If this is used, use dir argument as
well. Also see data.file to only process models that use a
specific data file.</p></dd>


<dt id="arg-dir">dir<a class="anchor" aria-label="anchor" href="#arg-dir"></a></dt>
<dd><p>If file.pattern is used, dir is the directory to search
for control streams in.</p></dd>


<dt id="arg-sge">sge<a class="anchor" aria-label="anchor" href="#arg-sge"></a></dt>
<dd><p>Use the sge queing system. Default is TRUE. Disable for
quick models not to wait for the queue to run the job.</p></dd>


<dt id="arg-input-archive">input.archive<a class="anchor" aria-label="anchor" href="#arg-input-archive"></a></dt>
<dd><p>A function of the model file path to generate
the path in which to archive the input data as RDS. Set to
NULL not to archive the data.</p></dd>


<dt id="arg-nc">nc<a class="anchor" aria-label="anchor" href="#arg-nc"></a></dt>
<dd><p>Number of cores to use if sending to the cluster. This
will only be used if <code>method.execute="psn"</code>, and
<code>sge=TRUE</code>. Default is 64.</p></dd>


<dt id="arg-dir-data">dir.data<a class="anchor" aria-label="anchor" href="#arg-dir-data"></a></dt>
<dd><p>The directory in which the data file is
stored. This is normally not needed as data will be found
using the path in the control stream. This argument may be
removed in the future since it should not be needed.</p></dd>


<dt id="arg-wait">wait<a class="anchor" aria-label="anchor" href="#arg-wait"></a></dt>
<dd><p>Wait for process to finish before making R console
available again? This is useful if calling NMexec from a
function that needs to wait for the output of the Nonmem run
to be available for further processing.</p></dd>


<dt id="arg-args-psn-execute">args.psn.execute<a class="anchor" aria-label="anchor" href="#arg-args-psn-execute"></a></dt>
<dd><p>A character string with arguments passed
to execute. Default is
"-model_dir_name -nm_output=coi,cor,cov,ext,phi,shk,xml".</p></dd>


<dt id="arg-update-only">update.only<a class="anchor" aria-label="anchor" href="#arg-update-only"></a></dt>
<dd><p>Only run model(s) if control stream or data
updated since last run?</p></dd>


<dt id="arg-nmquiet">nmquiet<a class="anchor" aria-label="anchor" href="#arg-nmquiet"></a></dt>
<dd><p>Suppress terminal output from `Nonmem`. This is
likely to only work on linux/unix systems.</p></dd>


<dt id="arg-method-execute">method.execute<a class="anchor" aria-label="anchor" href="#arg-method-execute"></a></dt>
<dd><p>How to run Nonmem. Must be one of 'psn',
    'nmsim', or 'direct'.</p><ul><li><p>psn PSN's execute is used. This supports parallel Nonmem
runs. Use the <code>nc</code> argument to control how many cores to use
for each job. For estimation runs, this is most likely the better
choice, if you have PSN installed. See <code>dir.psn</code> argument
too.</p></li>
<li><p>nmsim Creates a temporary directory and runs Nonmem
inside that directory before copying relevant results files back
to the folder where the input control stream was. If
<code>sge=TRUE</code>, the job will be submitted to a cluster, but
parallel execution of the job itself is not supported. See
<code>path.nonmem</code> argument too.</p></li>
<li><p>direct Nonmem is called directly on the control stream. This
is the simplest method and is the least convenient in most
cases. It does not offer parallel runs and leaves all the Nonmem
output files next to the control streams.</p></li>
</ul><p>See `sge` as well.</p></dd>


<dt id="arg-dir-psn">dir.psn<a class="anchor" aria-label="anchor" href="#arg-dir-psn"></a></dt>
<dd><p>The directory in which to find PSN
executables. This is only needed if these are not searchable
in the system path, or if the user should want to be explicit
about where to find them (i.e. want to use a specific
installed version of PSN).</p></dd>


<dt id="arg-path-nonmem">path.nonmem<a class="anchor" aria-label="anchor" href="#arg-path-nonmem"></a></dt>
<dd><p>The path to the nonmem executable. Only used if
<code>method.execute="direct"</code> or
<code>method.execute="nmsim"</code> (which is not default). If this
argument is not supplied, NMexec will try to run nmfe75,
i.e. this has to be available in the path of the underlying
shell. The default value can be modified using
<code><a href="https://philipdelff.github.io/NMdata/reference/NMdataConf.html" class="external-link">NMdata::NMdataConf</a></code>, like
<code>NMdataConf(path.nonmem="/path/to/nonmem")</code></p></dd>


<dt id="arg-system-type">system.type<a class="anchor" aria-label="anchor" href="#arg-system-type"></a></dt>
<dd><p>A charachter string, either \"windows\" or
\"linux\" - case insensitive. Windows is only experimentally
supported. Default is to use <code>Sys.info()[["sysname"]]</code>.</p></dd>


<dt id="arg-files-needed">files.needed<a class="anchor" aria-label="anchor" href="#arg-files-needed"></a></dt>
<dd><p>In case method.execute="nmsim", this argument
specifies files to be copied into the temporary directory
before Nonmem is run. Input control stream and simulation
input data does not need to be specified.</p></dd>


<dt id="arg-clean">clean<a class="anchor" aria-label="anchor" href="#arg-clean"></a></dt>
<dd><p>The degree of cleaning (file removal) to do after
Nonmem execution. If `method.execute=="psn"`, this is passed
to PSN's `execute`. If `method.execute=="nmsim"` a similar
behavior is applied, even though not as granular. NMsim's
internal method only distinguishes between 0 (no cleaning),
any integer 1-4 (default, quite a bit of cleaning) and 5
(remove temporary dir completely).</p></dd>


<dt id="arg-backup">backup<a class="anchor" aria-label="anchor" href="#arg-backup"></a></dt>
<dd><p>Before running, should existing results files be
backed up in a sub directory? If not, the files will be
deleted before running.</p></dd>


<dt id="arg-quiet">quiet<a class="anchor" aria-label="anchor" href="#arg-quiet"></a></dt>
<dd><p>Suppress messages on what NMexec is doing? Default is
FALSE.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>NULL (invisibly)</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Use this to read the archived input data when retrieving
    the nonmem results:
    <code>NMdataConf(file.data=inputArchiveDefault)</code></p>
<p>Since `NMexec` will typically not be used for simulations directly
(`NMsim` is the natural interface for that purpose), the default
method for `NMexec` is currently to use `method.execute="psn"`
which is at this point the only of the methods that allow for
multi-core execution of a single Nonmem job (NB:
`method.execute="NMsim"` can run multiple jobs in parallel which
is normally sufficient for simulations).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">file.mod</span> <span class="op">&lt;-</span> <span class="st">"run001.mod"</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co">## run locally - not on cluster</span></span></span>
<span class="r-in"><span><span class="fu">NMexec</span><span class="op">(</span><span class="va">file.mod</span>,sge<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## run on cluster with 16 cores. 64 cores is default</span></span></span>
<span class="r-in"><span><span class="fu">NMexec</span><span class="op">(</span><span class="va">file.mod</span>,nc<span class="op">=</span><span class="fl">16</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## submit multiple models to cluster</span></span></span>
<span class="r-in"><span><span class="va">multiple.models</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"run001.mod"</span>,<span class="st">"run002.mod"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">NMexec</span><span class="op">(</span><span class="va">multiple.models</span>,nc<span class="op">=</span><span class="fl">16</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## run all models called run001.mod - run099.mod if updated. 64 cores to each.</span></span></span>
<span class="r-in"><span><span class="fu">NMexec</span><span class="op">(</span>file.pattern<span class="op">=</span><span class="st">"run0..\\.mod"</span>,dir<span class="op">=</span><span class="st">"models"</span>,nc<span class="op">=</span><span class="fl">16</span>,update.only<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Philip Delff.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>



  <script data-goatcounter="https://nmsim.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script></body></html>

